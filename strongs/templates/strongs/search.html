{% extends "baseTemplate.html" %}
{% block content %}
    <table class="col-md-12 table-bible">
        <tr>
            <th class="col-md-3">{{translation1}}</th>
            <th class="col-md-3 hidden-xs">{{translation2}}</th>
            <th class="col-md-3 hidden-xs">{{translation3}}</th>
            <th class="col-md-3 hidden-xs">{{translation4}}</th>
        </tr>
        {% for vers1, vers2, vers3, vers4 in verses %}
        <tr>
            {% autoescape off %}
            {% load strongs_extras %}
            <td class="col-md-3">
                {% if vers1 != None %}
                <span class="versenr"><a href="/{{vers1.bookNr.short_name}}{{vers1.chapterNr}},{{vers1.versNr}}">{{vers1}}</a></span><span class="verse" id="{{vers1.bookNr.short_name}}{{vers1.chapterNr}}_{{vers1.versNr}}">{{vers1.versText|correctverstext}}</span>
                {% endif %}
            </td>
            <td class="col-md-3 hidden-xs">
                {% if vers2 != None %}
                <span class="versenr"><a href="/{{vers2.bookNr.short_name}} {{vers2.chapterNr}},{{vers2.versNr}}">{{vers2}}</a></span><span class="verse" id="{{vers2.bookNr.short_name}}{{vers2.chapterNr}}_{{vers2.versNr}}">{{vers2.versText|correctverstext}}</span>
                {% endif %}
            </td>
            <td class="col-md-3 hidden-xs hidden-sm hidden-md">
                {% if vers3 != None %}
                <span class="versenr"><a href="/{{vers3.bookNr.short_name}} {{vers3.chapterNr}},{{vers3.versNr}}">{{vers3}}</a></span><span class="verse" id="{{vers3.bookNr.short_name}}{{vers3.chapterNr}}_{{vers3.versNr}}">{{vers3.versText|correctverstext}}</span>
                {% endif %}
            </td>
            <td class="col-md-3 hidden-xs hidden-sm hidden-md">
                {% if vers4 != None %}
                <span class="versenr"><a href="/{{vers4.bookNr.short_name}} {{vers4.chapterNr}},{{vers4.versNr}}">{{vers4}}</a></span><span class="verse" id="{{vers4.bookNr.short_name}}{{vers4.chapterNr}}_{{vers4.versNr}}">{{vers4.versText|correctverstext}}</span>
                {% endif %}
            </td>
            {% endautoescape %}
        </tr>
        {% endfor %}
        <tr>
            <td></td>
            <td class="col-md-3 hidden-xs">
                <div class="copyright">
                    <br/>
                    Bibeltext der Schlachter<br/>
                    Copyright Â© 2000 Genfer Bibelgesellschaft<br/>
                    Wiedergegeben mit freundlicher Genehmigung. Alle Rechte vorbehalten.<br/>
                </div>
            </td>
            <td class="col-md-3 hidden-xs hidden-sm hidden-md"></td>
            <td class="col-md-3 hidden-xs hidden-sm hidden-md"></td>
        </tr>
    </table>
{% endblock %}

{% block js %}
    {%if search %}
        <script>
            function shlex(str) {
                var args = str.split(" ");
                var out = [];
                var lookForClose = -1;
                var quoteOpen = false;
                for (var x in args) {
                    if (args.hasOwnProperty(x)) {
                        var arg = args[x];
                        var escSeq = false;
                        for (var y in arg) {
                            if (escSeq) {
                                escSeq = false;
                            } else if (arg[y] === "\\") {
                                escSeq = true;
                            } else if (arg[y] === "\"") {
                                quoteOpen = !quoteOpen;
                            }
                        }
                        if (!quoteOpen && lookForClose === -1) {
                            out.push(arg);
                        } else if (quoteOpen && lookForClose === -1) {
                            lookForClose = x;
                        } else if (!quoteOpen && lookForClose >= 0) {
                            var block = args.slice(lookForClose, parseInt(x) + 1).join(" ");
                            var escSeq = false;
                            var quotes = [];
                            for (var y in block) {
                                if (escSeq) {
                                    escSeq = false;
                                } else if (block[y] === "\\") {
                                    escSeq = true;
                                } else if (block[y] === "\"") {
                                    quotes.push(y);
                                }
                            }
                            var parts = [];
                            parts.push(block.substr(0, quotes[0]));
                            parts.push(block.substr(parseInt(quotes[0]) + 1, quotes[1] - (parseInt(quotes[0]) + 1)));
                            parts.push(block.substr(parseInt(quotes[1]) + 1));
                            block = parts.join("");
                            out.push(block);
                            lookForClose = -1;
                        }
                    }
                }
                return quoteOpen ? false : out;
            }
            function highLight(substring, block) {
               $(block).find(".search-highlight").each(function () {
                  $(this).outerHtml($(this).html());
               });
               // now the block is free from previous highlights

               substrings = shlex(substring.replace(/&quot;/g, '"'));
               for(i = 0; i < substrings.length; ++i) {
                 $(block).html($(block).html().replace(new RegExp(substrings[i].replace(/"/g, "").replace(/'/g, ""), 'gi'), function(match, text, urlId){
                    return '<span class="search-highlight">' + match + '</span>'
                 }));
               }
            }

            highLight("{{ search }}", "#content");
        </script>
    {% endif %}
{% endblock %}